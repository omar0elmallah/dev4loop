<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevHub - منصة المبرمجين</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f3f4f6;
        }
        .sidebar {
            transition: transform 0.3s ease;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
        }
        .post-image {
            max-height: 400px;
            object-fit: cover;
        }
        .comment-input {
            transition: height 0.2s ease;
        }
        .notification {
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBfXJ-2tmCYo-pQjfN_4nAdxC-NcqfjAlo",
            authDomain: "tamec-8f9ea.firebaseapp.com",
            projectId: "tamec-8f9ea",
            storageBucket: "tamec-8f9ea.appspot.com",
            messagingSenderId: "372610375354",
            appId: "1:372610375354:web:1beaff9695e7b49cdeec83",
            measurementId: "G-W7TT6VTKSP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        emailjs.init('YOUR_EMAILJS_USER_ID'); // Replace with your EmailJS user ID

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('explore');
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [notifications, setNotifications] = useState([]);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        loadNotifications(currentUser.uid);
                    }
                });
                return () => unsubscribe();
            }, []);

            const loadNotifications = async (userId) => {
                const snapshot = await db.collection('notifications')
                    .where('userId', '==', userId)
                    .orderBy('timestamp', 'desc')
                    .limit(5)
                    .get();
                setNotifications(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
            };

            const toggleSidebar = () => setIsSidebarOpen(!isSidebarOpen);

            return (
                <div className="min-h-screen">
                    {user ? (
                        <div className="flex">
                            <Sidebar
                                activeTab={activeTab}
                                setActiveTab={setActiveTab}
                                isOpen={isSidebarOpen}
                                toggleSidebar={toggleSidebar}
                            />
                            <div className="flex-1 p-4 md:mr-64">
                                <Header
                                    user={user}
                                    notifications={notifications}
                                    toggleSidebar={toggleSidebar}
                                />
                                {activeTab === 'explore' && <Explore user={user} />}
                                {activeTab === 'web-requests' && <WebRequests user={user} />}
                                {activeTab === 'profile' && <Profile user={user} />}
                                {activeTab === 'settings' && <Settings user={user} />}
                            </div>
                        </div>
                    ) : (
                        <Auth />
                    )}
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ activeTab, setActiveTab, isOpen, toggleSidebar }) {
            const tabs = [
                { id: 'explore', name: 'استكشف', icon: 'fa-compass' },
                { id: 'web-requests', name: 'طلبات ويب', icon: 'fa-code' },
                { id: 'profile', name: 'ملفي الشخصي', icon: 'fa-user' },
                { id: 'settings', name: 'الإعدادات', icon: 'fa-cog' },
            ];

            return (
                <div className={`fixed top-0 right-0 h-full w-64 bg-gray-900 text-white p-4 transform ${isOpen ? 'active' : ''} sidebar z-50 md:transform-none`}>
                    <div className="text-xl font-bold mb-6">DevHub</div>
                    <nav>
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                className={`flex items-center w-full p-2 mb-2 rounded ${activeTab === tab.id ? 'bg-gray-700' : 'hover:bg-gray-800'}`}
                                onClick={() => {
                                    setActiveTab(tab.id);
                                    toggleSidebar();
                                }}
                            >
                                <i className={`fas ${tab.icon} ml-2`}></i>
                                {tab.name}
                            </button>
                        ))}
                        <button
                            className="flex items-center w-full p-2 rounded hover:bg-gray-800"
                            onClick={() => auth.signOut()}
                        >
                            <i className="fas fa-sign-out-alt ml-2"></i>
                            تسجيل الخروج
                        </button>
                    </nav>
                </div>
            );
        }

        // Header Component
        function Header({ user, notifications, toggleSidebar }) {
            return (
                <div className="flex justify-between items-center mb-6 p-4 bg-white rounded-lg shadow">
                    <div className="flex items-center">
                        <button className="md:hidden mr-4" onClick={toggleSidebar}>
                            <i className="fas fa-bars text-2xl"></i>
                        </button>
                        <h1 className="text-2xl font-bold text-gray-800">DevHub</h1>
                    </div>
                    <div className="flex items-center space-x-4">
                        <div className="relative">
                            <i className="fas fa-bell text-xl cursor-pointer"></i>
                            {notifications.length > 0 && (
                                <span className="absolute -top-2 -left-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">
                                    {notifications.length}
                                </span>
                            )}
                            <div className="absolute left-0 mt-2 w-64 bg-white rounded-lg shadow-lg hidden group-hover:block">
                                {notifications.map(note => (
                                    <div key={note.id} className="p-2 border-b notification">
                                        {note.message}
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">
                            {user.displayName?.charAt(0) || user.email?.charAt(0)}
                        </div>
                    </div>
                </div>
            );
        }

        // Auth Component
        function Auth() {
            const [isLogin, setIsLogin] = useState(true);
            const [isForgotPassword, setIsForgotPassword] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [name, setName] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    if (isForgotPassword) {
                        await auth.sendPasswordResetEmail(email);
                        alert('تم إرسال رابط إعادة تعيين كلمة المرور');
                        setIsForgotPassword(false);
                        setIsLogin(true);
                    } else if (isLogin) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        if (password !== confirmPassword) {
                            setError('كلمات المرور غير متطابقة');
                            return;
                        }
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        await db.collection('users').doc(userCredential.user.uid).set({
                            name,
                            email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleGoogleSignIn = async () => {
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    const result = await auth.signInWithPopup(provider);
                    await db.collection('users').doc(result.user.uid).set({
                        name: result.user.displayName,
                        email: result.user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleGitHubSignIn = async () => {
                try {
                    const provider = new firebase.auth.GithubAuthProvider();
                    const result = await auth.signInWithPopup(provider);
                    await db.collection('users').doc(result.user.uid).set({
                        name: result.user.displayName || result.user.email,
                        email: result.user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                } catch (err) {
                    setError(err.message);
                }
            };

            return (
                <div className="min-h-screen flex">
                    <div className="hidden md:flex flex-1 bg-gradient-to-br from-blue-600 to-green-500 items-center justify-center text-white p-8">
                        <div className="text-center">
                            <h1 className="text-4xl font-bold mb-4">مرحبًا بك في DevHub</h1>
                            <p className="text-lg">منصة المبرمجين للتواصل، مشاركة المعرفة، وبناء المشاريع</p>
                        </div>
                    </div>
                    <div className="flex-1 flex items-center justify-center bg-white p-8">
                        <div className="w-full max-w-md">
                            <h2 className="text-3xl font-bold mb-6 text-center">
                                {isForgotPassword ? 'إعادة تعيين كلمة المرور' : isLogin ? 'تسجيل الدخول' : 'إنشاء حساب'}
                            </h2>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                {!isForgotPassword && !isLogin && (
                                    <div>
                                        <label className="block text-sm font-medium">الاسم</label>
                                        <input
                                            type="text"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            className="w-full p-2 border rounded focus:border-blue-600"
                                            required
                                        />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-sm font-medium">البريد الإلكتروني</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full p-2 border rounded focus:border-blue-600"
                                        required
                                    />
                                </div>
                                {!isForgotPassword && (
                                    <div>
                                        <label className="block text-sm font-medium">كلمة المرور</label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            className="w-full p-2 border rounded focus:border-blue-600"
                                            required
                                        />
                                    </div>
                                )}
                                {!isForgotPassword && !isLogin && (
                                    <div>
                                        <label className="block text-sm font-medium">تأكيد كلمة المرور</label>
                                        <input
                                            type="password"
                                            value={confirmPassword}
                                            onChange={(e) => setConfirmPassword(e.target.value)}
                                            className="w-full p-2 border rounded focus:border-blue-600"
                                            required
                                        />
                                    </div>
                                )}
                                {error && <p className="text-red-500 text-sm">{error}</p>}
                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700"
                                >
                                    {isForgotPassword ? 'إرسال' : isLogin ? 'تسجيل الدخول' : 'إنشاء حساب'}
                                </button>
                            </form>
                            {!isForgotPassword && (
                                <div className="mt-4 space-y-2">
                                    <button
                                        onClick={handleGoogleSignIn}
                                        className="w-full bg-red-600 text-white p-2 rounded hover:bg-red-700 flex items-center justify-center"
                                    >
                                        <i className="fab fa-google mr-2"></i> تسجيل الدخول بجوجل
                                    </button>
                                    <button
                                        onClick={handleGitHubSignIn}
                                        className="w-full bg-gray-800 text-white p-2 rounded hover:bg-gray-900 flex items-center justify-center"
                                    >
                                        <i className="fab fa-github mr-2"></i> تسجيل الدخول بجيت هاب
                                    </button>
                                    <div className="text-center mt-4">
                                        <a
                                            href="#"
                                            onClick={() => {
                                                setIsLogin(!isLogin);
                                                setIsForgotPassword(false);
                                                setError('');
                                            }}
                                            className="text-blue-600 hover:underline"
                                        >
                                            {isLogin ? 'إنشاء حساب' : 'تسجيل الدخول'}
                                        </a>
                                    </div>
                                    {isLogin && (
                                        <div className="text-center mt-2">
                                            <a
                                                href="#"
                                                onClick={() => {
                                                    setIsForgotPassword(true);
                                                    setError('');
                                                }}
                                                className="text-blue-600 hover:underline"
                                            >
                                                نسيت كلمة المرور؟
                                            </a>
                                        </div>
                                    )}
                                </div>
                            )}
                            {isForgotPassword && (
                                <div className="text-center mt-4">
                                    <a
                                        href="#"
                                        onClick={() => {
                                            setIsForgotPassword(false);
                                            setIsLogin(true);
                                            setError('');
                                        }}
                                        className="text-blue-600 hover:underline"
                                    >
                                        العودة إلى تسجيل الدخول
                                    </a>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Explore Component
        function Explore({ user }) {
            const [posts, setPosts] = useState([]);
            const [content, setContent] = useState('');
            const [image, setImage] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const unsubscribe = db.collection('posts')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        setPosts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    });
                return () => unsubscribe();
            }, []);

            const handlePost = async (e) => {
                e.preventDefault();
                if (!content && !image) return;
                setLoading(true);

                try {
                    let imageUrl = '';
                    if (image) {
                        const storageRef = storage.ref(`posts/${user.uid}/${Date.now()}`);
                        await storageRef.put(image);
                        imageUrl = await storageRef.getDownloadURL();
                    }

                    const postData = {
                        authorId: user.uid,
                        authorName: user.displayName || user.email,
                        authorPhoto: user  user.photoURL || 'https://via.placeholder.com/40',
                        content,
                        imageUrl,
                        likes: 0,
                        comments: [],
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    // Save to Firestore
                    const postRef = await db.collection('posts').add(postData);

                    // Sync with GitHub (simulated)
                    await axios.post('https://api.github.com/repos/YOUR_USERNAME/YOUR_REPO/contents/posts/' + postRef.id, {
                        message: `New post by ${user.email}`,
                        content: btoa(JSON.stringify(postData))
                    }, {
                        headers: {
                            Authorization: 'Bearer YOUR_GITHUB_TOKEN',
                            Accept: 'application/vnd.github.v3+json'
                        }
                    });

                    setContent('');
                    setImage(null);
                    setLoading(false);
                    alert('تم النشر بنجاح!');
                } catch (err) {
                    console.error(err);
                    alert('حدث خطأ أثناء النشر');
                    setLoading(false);
                }
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-4">اكسبلور</h2>
                    <form onSubmit={handlePost} className="mb-6">
                        <div className="flex items-start space-x-4">
                            <img
                                src={user.photoURL || 'https://via.placeholder.com/40'}
                                alt="Avatar"
                                className="w-10 h-10 rounded-full"
                            />
                            <div className="flex-1">
                                <textarea
                                    value={content}
                                    onChange={(e) => setContent(e.target.value)}
                                    placeholder="ما الذي تريد مشاركته؟"
                                    className="w-full p-2 border rounded resize-none focus:border-blue-600"
                                    rows="3"
                                ></textarea>
                                <div className="flex justify-between mt-2">
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={(e) => setImage(e.target.files[0])}
                                        className="text-sm"
                                    />
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400"
                                    >
                                        {loading ? 'جاري النشر...' : 'نشر'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div className="space-y-6">
                        {posts.map(post => (
                            <Post key={post.id} post={post} user={user} />
                        ))}
                    </div>
                </div>
            );
        }

        // Post Component
        function Post({ post, user }) {
            const [comment, setComment] = useState('');
            const [showComments, setShowComments] = useState(false);

            const handleLike = async () => {
                try {
                    await db.collection('posts').doc(post.id).update({
                        likes: firebase.firestore.FieldValue.increment(1)
                    });
                    await db.collection('notifications').add({
                        userId: post.authorId,
                        message: `${user.displayName || user.email} أعجب بمنشورك`,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (err) {
                    console.error(err);
                }
            };

            const handleComment = async (e) => {
                e.preventDefault();
                if (!comment.trim()) return;

                try {
                    await db.collection('posts').doc(post.id).update({
                        comments: firebase.firestore.FieldValue.arrayUnion({
                            authorId: user.uid,
                            authorName: user.displayName || user.email,
                            content: comment,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        })
                    });
                    await db.collection('notifications').add({
                        userId: post.authorId,
                        message: `${user.displayName || user.email} علق على منشورك`,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setComment('');
                } catch (err) {
                    console.error(err);
                }
            };

            const handleShare = async () => {
                try {
                    await navigator.share({
                        title: 'منشور من DevHub',
                        text: post.content,
                        url: window.location.href
                    });
                } catch (err) {
                    console.error(err);
                }
            };

            return (
                <div className="bg-gray-50 p-4 rounded-lg">
                    <div className="flex items-start space-x-4">
                        <img
                            src={post.authorPhoto}
                            alt="Avatar"
                            className="w-10 h-10 rounded-full"
                        />
                        <div className="flex-1">
                            <div className="flex justify-between">
                                <div>
                                    <h3 className="font-bold">{post.authorName}</h3>
                                    <p className="text-sm text-gray-500">
                                        {post.createdAt?.toDate().toLocaleString('ar-EG')}
                                    </p>
                                </div>
                            </div>
                            <p className="mt-2">{post.content}</p>
                            {post.imageUrl && (
                                <img
                                    src={post.imageUrl}
                                    alt="Post"
                                    className="mt-2 w-full rounded-lg post-image"
                                />
                            )}
                            <div className="flex space-x-4 mt-4">
                                <button
                                    onClick={handleLike}
                                    className="flex items-center text-blue-600 hover:text-blue-800"
                                >
                                    <i className="far fa-heart mr-1"></i> {post.likes}
                                </button>
                                <button
                                    onClick={() => setShowComments(!showComments)}
                                    className="flex items-center text-gray-600 hover:text-gray-800"
                                >
                                    <i className="far fa-comment mr-1"></i> {post.comments?.length || 0}
                                </button>
                                <button
                                    onClick={handleShare}
                                    className="flex items-center text-green-600 hover:text-green-800"
                                >
                                    <i className="fas fa-share mr-1"></i> مشاركة
                                </button>
                            </div>
                            {showComments && (
                                <div className="mt-4">
                                    <form onSubmit={handleComment} className="mb-4">
                                        <textarea
                                            value={comment}
                                            onChange={(e) => setComment(e.target.value)}
                                            placeholder="أضف تعليقًا..."
                                            className="w-full p-2 border rounded resize-none focus:border-blue-600 comment-input"
                                            rows="2"
                                        ></textarea>
                                        <button
                                            type="submit"
                                            className="mt-2 bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700"
                                        >
                                            إرسال
                                        </button>
                                    </form>
                                    {post.comments?.map((c, index) => (
                                        <div key={index} className="mb-2 p-2 bg-gray-100 rounded">
                                            <p className="font-bold">{c.authorName}</p>
                                            <p>{c.content}</p>
                                            <p className="text-xs text-gray-500">
                                                {c.createdAt?.toDate().toLocaleString('ar-EG')}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Web Requests Component
        function WebRequests({ user }) {
            const [projectName, setProjectName] = useState('');
            const [projectType, setProjectType] = useState('');
            const [description, setDescription] = useState('');
            const [budget, setBudget] = useState('');
            const [deadline, setDeadline] = useState('');
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const unsubscribe = db.collection('webRequests')
                    .where('userId', '==', user.uid)
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        setRequests(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    });
                return () => unsubscribe();
            }, [user.uid]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);

                try {
                    const requestData = {
                        userId: user.uid,
                        projectName,
                        projectType,
                        description,
                        budget,
                        deadline,
                        status: 'pending',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('webRequests').add(requestData);

                    // Send email via EmailJS
                    await emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', {
                        from_name: user.displayName || user.email,
                        to_email: 'omar.elmallah2011@gmail.com',
                        project_name: projectName,
                        project_description: description
                    });

                    setProjectName('');
                    setProjectType('');
                    setDescription('');
                    setBudget('');
                    setDeadline('');
                    setLoading(false);
                    alert('تم إرسال الطلب بنجاح!');
                } catch (err) {
                    console.error(err);
                    alert('حدث خطأ أثناء إرسال الطلب');
                    setLoading(false);
                }
            };

            const handleDelete = async (requestId) => {
                if (confirm('هل أنت متأكد من حذف هذا الطلب؟')) {
                    try {
                        await db.collection('webRequests').doc(requestId).delete();
                        alert('تم حذف الطلب بنجاح');
                    } catch (err) {
                        console.error(err);
                        alert('حدث خطأ أثناء الحذف');
                    }
                }
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-4">طلب موقع ويب</h2>
                    <form onSubmit={handleSubmit} className="space-y-4 mb-8">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium">اسم المشروع</label>
                                <input
                                    type="text"
                                    value={projectName}
                                    onChange={(e) => setProjectName(e.target.value)}
                                    className="w-full p-2 border rounded focus:border-blue-600"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium">نوع الموقع</label>
                                <select
                                    value={projectType}
                                    onChange={(e) => setProjectType(e.target.value)}
                                    className="w-full p-2 border rounded focus:border-blue-600"
                                    required
                                >
                                    <option value="">اختر نوع الموقع</option>
                                    <option value="ecommerce">متجر إلكتروني</option>
                                    <option value="blog">مدونة</option>
                                    <option value="portfolio">معرض أعمال</option>
                                    <option value="business">موقع شركة</option>
                                    <option value="webapp">تطبيق ويب</option>
                                    <option value="other">أخرى</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium">وصف المشروع</label>
                            <textarea
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                className="w-full p-2 border rounded focus:border-blue-600"
                                rows="4"
                                required
                            ></textarea>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium">الميزانية (اختياري)</label>
                                <input
                                    type="text"
                                    value={budget}
                                    onChange={(e) => setBudget(e.target.value)}
                                    className="w-full p-2 border rounded focus:border-blue-600"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium">الموعد النهائي (اختياري)</label>
                                <input
                                    type="date"
                                    value={deadline}
                                    onChange={(e) => setDeadline(e.target.value)}
                                    className="w-full p-2 border rounded focus:border-blue-600"
                                />
                            </div>
                        </div>
                        <button
                            type="submit"
                            disabled={loading}
                            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400"
                        >
                            {loading ? 'جاري الإرسال...' : 'إرسال الطلب'}
                        </button>
                    </form>
                    <h3 className="text-xl font-bold mb-4">طلباتي السابقة</h3>
                    {requests.length === 0 ? (
                        <p>لا توجد طلبات سابقة</p>
                    ) : (
                        <div className="space-y-4">
                            {requests.map(request => (
                                <div key={request.id} className="bg-gray-50 p-4 rounded-lg">
                                    <div className="flex justify-between items-center">
                                        <h4 className="font-bold">{request.projectName}</h4>
                                        <span
                                            className={`px-2 py-1 rounded text-sm ${
                                                request.status === 'pending'
                                                    ? 'bg-yellow-100 text-yellow-800'
                                                    : request.status === 'in-progress'
                                                    ? 'bg-blue-100 text-blue-800'
                                                    : 'bg-green-100 text-green-800'
                                            }`}
                                        >
                                            {request.status === 'pending'
                                                ? 'قيد المراجعة'
                                                : request.status === 'in-progress'
                                                ? 'قيد التنفيذ'
                                                : 'مكتمل'}
                                        </span>
                                    </div>
                                    <p className="mt-2">{request.description}</p>
                                    <div className="mt-2 text-sm text-gray-500">
                                        <p>تم الإنشاء: {request.createdAt?.toDate().toLocaleDateString('ar-EG')}</p>
                                        {request.budget && <p>الميزانية: {request.budget}</p>}
                                        {request.deadline && <p>الموعد النهائي: {new Date(request.deadline).toLocaleDateString('ar-EG')}</p>}
                                    </div>
                                    <button
                                        onClick={() => handleDelete(request.id)}
                                        className="mt-2 text-red-600 hover:text-red-800"
                                    >
                                        حذف
                                    </button>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Profile Component
        function Profile({ user }) {
            const [userData, setUserData] = useState({});
            const [activeTab, setActiveTab] = useState('posts');
            const [posts, setPosts] = useState([]);

            useEffect(() => {
                const fetchUserData = async () => {
                    const doc = await db.collection('users').doc(user.uid).get();
                    setUserData(doc.data() || {});
                };

                const fetchPosts = async () => {
                    const snapshot = await db.collection('posts')
                        .where('authorId', '==', user.uid)
                        .orderBy('createdAt', 'desc')
                        .get();
                    setPosts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                };

                fetchUserData();
                fetchPosts();
            }, [user.uid]);

            const handleEditProfile = async () => {
                const newName = prompt('أدخل اسمك الجديد:', userData.name);
                if (newName) {
                    try {
                        await db.collection('users').doc(user.uid).update({ name: newName });
                        setUserData({ ...userData, name: newName });
                        alert('تم تحديث الملف الشخصي');
                    } catch (err) {
                        console.error(err);
                        alert('حدث خطأ أثناء تحديث الملف الشخصي');
                    }
                }
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow">
                    <div className="text-center mb-6">
                        <img
                            src={user.photoURL || 'https://via.placeholder.com/120'}
                            alt="Avatar"
                            className="w-32 h-32 rounded-full mx-auto mb-4"
                        />
                        <h2 className="text-2xl font-bold">{userData.name || user.email}</h2>
                        <p className="text-gray-600">{userData.bio || 'لا توجد سيرة ذاتية'}</p>
                        <button
                            onClick={handleEditProfile}
                            className="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                        >
                            تعديل الملف الشخصي
                        </button>
                    </div>
                    <div className="flex border-b mb-4">
                        {['posts', 'projects', 'about'].map(tab => (
                            <button
                                key={tab}
                                className={`flex-1 p-2 text-center ${
                                    activeTab === tab
                                        ? 'border-b-2 border-blue-600 text-blue-600'
                                        : 'text-gray-600 hover:bg-gray-100'
                                }`}
                                onClick={() => setActiveTab(tab)}
                            >
                                {tab === 'posts' ? 'المشاركات' : tab === 'projects' ? 'المشاريع' : 'معلومات عني'}
                            </button>
                        ))}
                    </div>
                    <div>
                        {activeTab === 'posts' && (
                            <div className="space-y-4">
                                {posts.length === 0 ? (
                                    <p>لا توجد مشاركات</p>
                                ) : (
                                    posts.map(post => (
                                        <Post key={post.id} post={post} user={user} />
                                    ))
                                )}
                            </div>
                        )}
                        {activeTab === 'projects' && (
                            <div>
                                <p>قائمة المشاريع (قيد التطوير)</p>
                            </div>
                        )}
                        {activeTab === 'about' && (
                            <div>
                                <h3 className="text-xl font-bold mb-2">معلومات أساسية</h3>
                                <p>البريد الإلكتروني: {user.email}</p>
                                <p>تاريخ الانضمام: {userData.createdAt?.toDate().toLocaleDateString('ar-EG')}</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Settings Component
        function Settings({ user }) {
            const [emailNotifications, setEmailNotifications] = useState(true);
            const [darkMode, setDarkMode] = useState(false);

            const handleSave = async () => {
                try {
                    await db.collection('users').doc(user.uid).update({
                        preferences: {
                            emailNotifications,
                            darkMode
                        }
                    });
                    alert('تم حفظ الإعدادات');
                } catch (err) {
                    console.error(err);
                    alert('حدث خطأ أثناء حفظ الإعدادات');
                }
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-4">الإعدادات</h2>
                    <div className="space-y-4">
                        <div className="flex items-center justify-between">
                            <label className="text-sm font-medium">إشعارات البريد الإلكتروني</label>
                            <input
                                type="checkbox"
                                checked={emailNotifications}
                                onChange={(e) => setEmailNotifications(e.target.checked)}
                                className="h-5 w-5"
                            />
                        </div>
                        <div className="flex items-center justify-between">
                            <label className="text-sm font-medium">الوضع الداكن</label>
                            <input
                                type="checkbox"
                                checked={darkMode}
                                onChange={(e) => setDarkMode(e.target.checked)}
                                className="h-5 w-5"
                            />
                        </div>
                        <button
                            onClick={handleSave}
                            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                        >
                            حفظ التغييرات
                        </button>
                    </div>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
